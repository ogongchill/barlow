name: ğŸ“† Run Batch Application in AWS Lambda

on:
  schedule:
    - cron: '0 3 * * 1-5'   # í•œêµ­ì‹œê°„ 12:00 (ì ì‹¬)
    - cron: '30 6 * * 1-5'  # í•œêµ­ì‹œê°„ 15:30
    - cron: '0 10 * * 1-5'  # í•œêµ­ì‹œê°„ 19:00

jobs:
  build:
    name: execute batch job
    runs-on: ubuntu-latest

    steps:
      - name: Get Current Time
        uses: 1466587594/get-current-time@v2
        id: current-time
        with:
          format: YYYY-MM-DDTHH:mm:ss
          timezone: 'Asia/Seoul'

      - name: Print Current Time
        run: echo "Current Time=${{ steps.current-time.outputs.formattedTime }}"
        shell: bash

      # í‰ì¼ ì˜¤í›„ 12ì‹œ : ì§„í–‰ì¤‘ì¸ ì…ë²•ì˜ˆê³  batch
      - name: Send POST request to Lambda
        if: github.event.schedule == '0 3 * * 1-5'
        env:
          LAMBDA_FUNC_URL: ${{ secrets.PROD_PRE_ANNOUNCE_BATCH_LAMBDA_URL }}
        run: |
          echo "Executing Tracking Pre Announcement Bill Batch Job"
          curl -X POST $LAMBDA_FUNC_URL -H "Content-Type: application/json"

      # í‰ì¼ ì˜¤í›„ 15ì‹œ 30ë¶„ : ë²•ì•ˆ ë³€ê²½ì‚¬í•­ ì¶”ì  batch
      - name: Send POST request to Lambda
        if: github.event.schedule == '30 6 * * 1-5'
        env:
          LAMBDA_FUNC_URL: ${{ secrets.PROD_TRACKING_BILL_BATCH_LAMBDA_URL }}
        run: |
          echo "Executing Tracking Bill Info Batch Job"
          curl -X POST $LAMBDA_FUNC_URL -H "Content-Type: application/json"

      # í‰ì¼ ì˜¤í›„ 19ì‹œ : ì˜¤ëŠ˜ ë°œì˜ëœ ë²•ì•ˆ batch
      - name: Send POST request to Lambda
        if: github.event.schedule == '0 10 * * 1-5'
        env:
          LAMBDA_FUNC_URL: ${{ secrets.PROD_UPDATE_TODAY_BILL_BATCH_LAMBDA_URL }}
        run: |
          echo "Executing Update Today Bill Batch Job"
          curl -X POST $LAMBDA_FUNC_URL -H "Content-Type: application/json"